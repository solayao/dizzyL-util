"use strict";var _createClass=function(){function n(n,e){for(var o=0;o<e.length;o++){var t=e[o];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(n,t.key,t)}}return function(e,o,t){return o&&n(e.prototype,o),t&&n(e,t),e}}();function _classCallCheck(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var MongoDB=require("mongodb"),MongoClient=MongoDB.MongoClient,DBpool=require("./DBpool"),_require=require("./config.json"),mongoConfig=_require.mongoConfig,_require2=require("../log/ChalkConsole"),SuccessConsole=_require2.SuccessConsole,ErrorConsole=_require2.ErrorConsole,InsertConsole=_require2.InsertConsole,dbName=mongoConfig.db,MongoResource=function(){function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:mongoConfig,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,n);var t=e.uri||e.url;t||(t=e.user&&e.pass?"mongodb://"+e.user+":"+e.pass+"@"+e.host+":"+e.port+"/"+e.db:"mongodb://"+e.host+":"+e.port+"/"+e.db);var r=function(){return MongoClient.connect(t,{useNewUrlParser:!0}).then(function(n){return SuccessConsole("DBpool message",__filename,"Connected MongoDB ("+t+") successfully to server."),n}).catch(function(n){ErrorConsole("DBpool message",__filename,"Connected MongoDB ("+t+") NOT successfully to server!\n\t"+n)})},i=function(n){n.close(),SuccessConsole("DBpool message",__filename,"Closed MongoDB ("+t+") successfully to server.")};this.mongoPool=Object.keys(o).length>0?new DBpool(r,i,o):new DBpool(r,i)}return _createClass(n,[{key:"close",value:function(){this.mongoPool.closePool()}},{key:"action",value:function(n){return this.mongoPool.sqlAction(n,__filename)}},{key:"actionInsert",value:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(e&&""!==n)return Array.isArray(e)&&0===e.length?[]:this.action(function(o){return new Promise(function(t,r){o.db(dbName).collection(n).insert(e).then(function(o){o.result.hasOwnProperty("ok")&&(SuccessConsole("DBpool message",__filename,"Insert (\n"+JSON.stringify(e)+"\n) to ("+n+") successfully."),InsertConsole("DBpool message",__filename,"Insert (\n"+JSON.stringify(e)+"\n) to ("+n+") successfully."),t(Object.values(o.insertedIds)))}).catch(function(n){return r(n)})})})}},{key:"actionQuery",value:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(e&&""!==n)return this.action(function(o){return new Promise(function(t,r){try{o.db(dbName).collection(n).find(e).toArray(function(n,e){t(e)})}catch(n){console.log(n)}})})}},{key:"actionAggregate",value:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(e&&""!==n)return this.action(function(o){return new Promise(function(t,r){try{o.db(dbName).collection(n).aggregate(e).toArray(function(n,e){t(e)})}catch(n){console.log(n)}})})}},{key:"actionUpdate",value:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,t=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(o&&e&&o)return this.action(function(i){return new Promise(function(s,l){i.db(dbName).collection(n).update(e,o,{upsert:t,multi:r}).then(function(e){SuccessConsole("DBpool message",__filename,"Update (\n"+JSON.stringify(o)+"\n) to ("+n+") successfully."),InsertConsole("DBpool message",__filename,"Update (\n"+JSON.stringify(o)+"\n) to ("+n+") successfully."),s()}).catch(function(n){return l(n)})})})}},{key:"actionForClient",value:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(n){};return this.action(function(e){return n(e)})}},{key:"distinct",value:function(){return this.action(function(n){return new Promise(function(e,o){n.db(dbName).collection("comic").distinct("n").then(function(n){e(n)}).catch(function(n){return o(n)})})})}}]),n}();module.exports=MongoResource;