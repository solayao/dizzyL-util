"use strict";var _createClass=function(){function e(e,r){for(var n=0;n<r.length;n++){var o=r[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(r,n,o){return n&&e(r.prototype,n),o&&e(r,o),r}}();function _asyncToGenerator(e){return function(){var r=e.apply(this,arguments);return new Promise(function(e,n){return function o(t,i){try{var s=r[t](i),u=s.value}catch(e){return void n(e)}if(!s.done)return Promise.resolve(u).then(function(e){o("next",e)},function(e){o("throw",e)});e(u)}("next")})}}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}var Redis=require("redis"),bluebird=require("bluebird");bluebird.promisifyAll(Redis);var DBpool=require("./DBpool"),_require=require("./config.json"),redisConfig=_require.redisConfig,_require2=require("../log/ChalkConsole"),SuccessConsole=_require2.SuccessConsole,ErrorConsole=_require2.ErrorConsole,RedisResource=function(){function e(){var r=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:redisConfig,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,e);var t,i={retry_strategy:function(e){return e.error&&"ECONNREFUSED"===e.error.code?(ErrorConsole("DBpool Message",__filename,""+e.error),new Error("The server refused the connection")):e.total_retry_time>36e5?(ErrorConsole("DBpool Message",__filename,"Retry time exhausted"),new Error("Retry time exhausted")):e.attempt>10?void 0:Math.min(100*e.attempt,3e3)}},s=function(){var e=Redis.createClient(Object.assign({},n,i));return SuccessConsole("DBpool Message",__filename,"Connected Reids ("+redisConfig.host+":"+redisConfig.port+") successfully to server."),e},u=(t=_asyncToGenerator(regeneratorRuntime.mark(function e(n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.quit();case 2:SuccessConsole("DBpool Message",__filename,"Closed Reids ("+redisConfig.host+":"+redisConfig.port+") successfully to server.");case 3:case"end":return e.stop()}},e,r)})),function(e){return t.apply(this,arguments)});this.redisPool=Object.keys(o).length>0?new DBpool(s,u,o):new DBpool(s,u)}return _createClass(e,[{key:"close",value:function(){this.redisPool.closePool()}},{key:"hmSet",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.redisPool.sqlAction(function(o){return new Promise(function(t,i){e&&o.HMSETAsync(e,r).then(function(){-1!==n&&o.EXPIREAsync(e,n),t()}).catch(function(e){return i(e)})})})}},{key:"hgetAll",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return this.redisPool.sqlAction(function(r){return new Promise(function(n,o){e&&r.HGETALLAsync(e).then(function(e){return n(e)}).catch(function(e){return o("err",e)})})})}},{key:"keys",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"*";return this.redisPool.sqlAction(function(r){return new Promise(function(n,o){r.KEYSAsync(e).then(function(e){return n(e)}).catch(function(e){return o("err",e)})})})}},{key:"flushall",value:function(){return this.redisPool.sqlAction(function(e){return e.FLUSHALLAsync()})}}]),e}();module.exports=RedisResource;