"use strict";var _createClass=function(){function e(e,r){for(var n=0;n<r.length;n++){var t=r[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(r,n,t){return n&&e(r.prototype,n),t&&e(r,t),r}}();function _asyncToGenerator(e){return function(){var r=e.apply(this,arguments);return new Promise(function(e,n){return function t(o,i){try{var s=r[o](i),u=s.value}catch(e){return void n(e)}if(!s.done)return Promise.resolve(u).then(function(e){t("next",e)},function(e){t("throw",e)});e(u)}("next")})}}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}var Redis=require("redis"),bluebird=require("bluebird");bluebird.promisifyAll(Redis);var DBpool=require("./DBpool"),_require=require("./config.json"),redisConfig=_require.redisConfig,_require2=require("../log/ChalkConsole"),SuccessConsole=_require2.SuccessConsole,ErrorConsole=_require2.ErrorConsole,RedisResource=function(){function e(){var r=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:redisConfig,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,e);var o,i={retry_strategy:function(e){return e.error&&"ECONNREFUSED"===e.error.code?(ErrorConsole("DBpool Message",__filename,""+e.error),new Error("The server refused the connection")):e.total_retry_time>36e5?(ErrorConsole("DBpool Message",__filename,"Retry time exhausted"),new Error("Retry time exhausted")):e.attempt>10?void 0:Math.min(100*e.attempt,3e3)}},s=function(){var e=Redis.createClient(Object.assign({},n,i));return SuccessConsole("DBpool Message",__filename,"Connected Reids ("+redisConfig.host+":"+redisConfig.port+") successfully to server."),e},u=(o=_asyncToGenerator(regeneratorRuntime.mark(function e(n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.quit();case 2:SuccessConsole("DBpool Message",__filename,"Closed Reids ("+redisConfig.host+":"+redisConfig.port+") successfully to server.");case 3:case"end":return e.stop()}},e,r)})),function(e){return o.apply(this,arguments)});this.redisPool=Object.keys(t).length>0?new DBpool(s,u,t):new DBpool(s,u)}return _createClass(e,[{key:"close",value:function(){this.redisPool.closePool()}},{key:"action",value:function(e){return this.redisPool.sqlAction(e,__filename)}},{key:"hmSet",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.action(function(t){return new Promise(function(o,i){e&&t.HMSETAsync(e,r).then(function(){-1!==n&&t.EXPIREAsync(e,n),o()}).catch(function(e){return i(e)})})})}},{key:"hgetAll",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return this.action(function(r){return new Promise(function(n,t){e&&r.HGETALLAsync(e).then(function(e){return n(e)}).catch(function(e){return t("err",e)})})})}},{key:"keys",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"*";return this.action(function(r){return new Promise(function(n,t){r.KEYSAsync(e).then(function(e){return n(e)}).catch(function(e){return t("err",e)})})})}},{key:"flushall",value:function(){return this.action(function(e){return e.FLUSHALLAsync()})}}]),e}();module.exports=RedisResource;